$(document).ready(function(){function e(){var e=new Date,t=e.toLocaleTimeString(),o=e.toLocaleDateString();$(".time").html(t+" "+o)}function t(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function o(){ticket=Cookies.getJSON("ticket_cookie");var e=1;for(var t in ticket)e*=parseFloat(ticket[t].cotation_value.replace(",","."));1==e&&(e=0),$(".cotation-total").text(parseFloat(e.toFixed(2))),COTATION_TOTAL=parseFloat(e.toFixed(2))}function a(e){var t=Cookies.getJSON("ticket_cookie");t[e.game_id]=e,Cookies.set("ticket_cookie",t),$.post("/bet/",e,function(e,t,o){console.log(o.status),"201"==o.status&&alertify.notify("Adicionado")},"text"),o(),r(parseFloat($($(".ticket-bet-value")[0]).val())),i()}function i(){ticket=Cookies.getJSON("ticket_cookie"),$(".ticket-list").empty();for(var e in ticket){var t='<div class="divider"></div><li class="center-align bet"><div class="game-id hide">'+ticket[e].game_id+'</div><div class="game-name">'+ticket[e].game_name+"</div><div>"+ticket[e].cotation_kind+'</div><div class="game-cotation">'+ticket[e].cotation_name+" : "+ticket[e].cotation_value+'</div><div class="bet-delete"><span class="valign-wrapper red-text">Remover<i class="small material-icons red-text">delete</i></span></div></li>';$(".ticket-list").append(t),$(".ticket-list").append('<div class="divider"></div>')}}function r(e){if(isNaN(e))$(".award-value").text("R$ 0.00");else{var t=(COTATION_TOTAL*e).toFixed(2);$(".award-value").text("R$ "+t)}}setInterval(function(){e()},1e3);var s=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),a=0;a<o.length;a++){var i=jQuery.trim(o[a]);if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}return t}("csrftoken");void 0==Cookies.get("ticket_cookie")&&Cookies.set("ticket_cookie",{}),i(),o(),$("#cellphone_register").mask("(99)99999-999?9");var n=window.location.hash.substr(1);"/login_error"==n&&alertify.alert("Erro","Login ou senha incorretos."),"/login_ok"==n&&alertify.alert("Sucesso","Você foi logado."),$(".button-collapse").sideNav(),$(".modal").modal(),$.ajaxSetup({beforeSend:function(e,o){t(o.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",s)}}),$("#validate-ticket-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize();""==$(".ticket-number-input").val()?alertify.alert("Erro","Você deve informar o número do ticket."):(alert_msg="Confirma a validação do ticket? \n Essa ação não pode ser desfeita.",alertify.confirm("Confirmação","Confirmação",alert_msg,function(){$.post("/seller/validate_ticket/",t,function(e,t,o){200==(e=jQuery.parseJSON(e)).status&&alertify.success("Ticket Validado."),404==e.status&&alertify.error("Ticket não encontrado."),403==e.status&&alertify.alert("Erro","Esse ticket não pode mais ser validado, pois um de seus jogos já começou ou terminou."),400==e.status&&alertify.error("Algo deu errado.")},"text")},function(){alertify.error("Cancelado")}))}),$("#reduce-cotations-form").on("submit",function(e){e.preventDefault();var t=$(".percent-reduction").val();if(t<1||t>100)alertify.alert("Erro","Escolha um número entre 1 e 100");else{var o;$.ajax({url:"/utils/cotation_reduction/"+t/100,method:"GET",beforeSend:function(e,t){o=alertify.alert().setHeader("<em> Carregando.... </em> ").set("closable",!1).set("frameless",!0).setContent('<div class="preloader-wrapper big active"><div class="spinner-layer spinner-blue-only"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div><div class="right">Processando... operação demorada, não faça isso o tempo todo.</div>').show()},complete:function(e,t){alertify.notify("Cotas alteradas com sucesso."),o.close()}})}}),$("#pay-punter-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize();""==$(".ticket-pay-input").val()?alertify.alert("Erro","Você deve informar o número do ticket."):(alert_msg="Confirma o pagamento do ticket? \n Essa ação não pode ser desfeita.",alertify.confirm("Confirmação",alert_msg,function(){$.post("/seller/punter_payment/",t,function(e,t,o){200==(e=jQuery.parseJSON(e)).status&&alertify.success("O Apostador foi pago com sucesso."),401==e.status&&alertify.error("Você não pode recompensar um Ticket que não venceu."),404==e.status&&alertify.error("Ticket não encontrado."),400==e.status&&alertify.error("Algo deu errado.")},"text")},function(){alertify.error("Cancelado")}))}),$(".ticket-bet-value-mobile").keyup(function(e){var t=parseFloat($(this).val());$(".ticket-bet-value-desktop").val(t),r(t)}),$(".ticket-bet-value-desktop").keyup(function(e){var t=parseFloat($(this).val());$(".ticket-bet-value-mobile").val(t),r(t)}),$(document).on("click",".bet-delete",function(){ticket=Cookies.getJSON("ticket_cookie"),game_id_to_delete=$(this).siblings().first().text().trim(),delete ticket[game_id_to_delete],Cookies.set("ticket_cookie",ticket),i(),o(),$(".ticket-bet-value").trigger("keyup"),$.ajax({url:"/bet/"+game_id_to_delete,method:"DELETE",complete:function(e){console.log(e.status)}})}),$(".cotation").click(function(e){var t=$(this).parent().siblings().first().children(".table-game-id").text().trim(),o=$(this).parent().siblings().first().children(".table-game-name").text().trim(),i=$(this).siblings().first().text(),r=$(this).siblings().eq(1).text().trim(),s=$(this).text().trim(),n=$(this).siblings().eq(2).text().trim();console.log(n),bet_info={game_id:t,game_name:o,cotation_id:i,cotation_name:r,cotation_value:s,cotation_kind:n},a(bet_info)}),$(".btn-bet-submit").on("click",function(){var e=Cookies.get("ticket_cookie");"True"==$(this).attr("desktop")?ticket_value=$(".ticket-bet-value-desktop").val():ticket_value=$(".ticket-bet-value-mobile").val(),ticket_value<=0?alertify.error("Você deve apostar um valor maior que 0."):(console.log(ticket_value),"{}"==e?(alertify.error("Nenhuma cota selecionada nessa sessão."),COTATION_TOTAL=0,i(),o()):""!=ticket_value?alertify.confirm("Confirmação","Confirmar aposta?",function(){$.post("/bet_ticket/",{ticket_value:ticket_value},function(e,t,o){var a=jQuery.parseJSON(e);401==a.status&&$("#modal-login").modal("open"),403==a.status&&alertify.error("Selecione cotas antes de apostar."),400==a.status&&alertify.alert("Erro","Erro ao tentar processar essa requisição. \n Por favor avise-nos pelo email: pabllobeg@gmail.com"),406==a.status&&alertify.alert("Erro","Prezado cliente, gostariamos de lhe informar que não aceitamos apostas com recompensa maior que R$ 4000.00"),417==a.status&&alertify.alert("Erro","Prezado cliente, você deve apostar em pelo menos 2 jogos."),201==a.status&&(console.log(a),alertify.alert("Sucesso","O número do Ticket de Aposta é: <b>"+a.ticket_pk+"</b><br /> Para acessar detalhes do Ticket, entre no painel de controle.<br /> Realize o pagamento com um de nossos colaboradoes usando o número do Ticket.")),console.log(a.status)},"text")},function(){alertify.error("Cancelado.")}):alertify.error("Informe o valor da sua aposta."))}),$(".btn-bet-submit-seller").on("click",function(){$("#modal-random-user").modal("open")}),$(".user-random").on("click",function(){$("#modal-random-user").modal("close");var e=$(".nome").val(),t=$(".telefone").val(),a=Cookies.get("ticket_cookie");"True"==$(this).attr("desktop")?(ticket_value=$(".ticket-bet-value-desktop").val(),alert("teste")):ticket_value=$(".ticket-bet-value-mobile").val(),ticket_value<=0?alertify.error("Você deve apostar um valor maior que 0."):(console.log(ticket_value),"{}"==a?(alertify.error("Nenhuma cota selecionada nessa sessão."),COTATION_TOTAL=0,i(),o()):""!=ticket_value?alertify.confirm("Confirmação","Confirmar aposta?",function(){$.post("/bet_ticket/",{ticket_value:ticket_value,nome:e,telefone:t},function(e,t,o){var a=jQuery.parseJSON(e);401==a.status&&$("#modal-login").modal("open"),403==a.status&&alertify.error("Selecione cotas antes de apostar."),400==a.status&&alertify.alert("Erro","Erro ao tentar processar essa requisição. \n Por favor avise-nos pelo email: pabllobeg@gmail.com"),406==a.status&&alertify.alert("Erro","Prezado cliente, gostariamos de lhe informar que não aceitamos apostas com recompensa maior que R$ 4000.00"),417==a.status&&alertify.alert("Erro","Prezado cliente, você deve apostar em pelo menos 2 jogos."),201==a.status&&(console.log(a),alertify.alert("Sucesso","O número do Ticket de Aposta é: <b>"+a.ticket_pk+"</b><br /> Para acessar detalhes do Ticket, entre no painel de controle.<br /> Realize o pagamento com um de nossos colaboradoes usando o número do Ticket.")),console.log(a.status)},"text")}):alertify.error("Informe o valor da sua aposta."))}),$(".more_cotations_button").on("click",function(e){$("#more-cotations").modal("open");var t=$(this).siblings().first().children(".table-game-id").text().trim(),o=$(this).siblings().first().children(".table-game-name").text().trim();$(".more_cotation_header").text(o);var a='<tr><td class="hide more-game-id">'+t+'</td><td class="hide more-game-name">'+o+"</td></tr>";$(".more-table tbody").empty().append(a),$.get("/cotations/"+t,function(e,t,o){var a=jQuery.parseJSON(e),i="";for(key in a){i+='<tr><td class="cotation-market-label">'+key+'</td><td class="cotation-market-label"></td></tr>';for(var r=jQuery.parseJSON(a[key]),s=r.length,n=0;n<s;n++)i+='<tr><td class="hide">'+r[n].pk+"</td><td>"+r[n].fields.name+'</td><td class="more-cotation">'+r[n].fields.value+'</td><td class="more-cotation-kind hide">'+r[n].fields.kind+"</td></tr>"}$(".more-table tbody").append(i)},"text")}),$(document).on("click",".more-cotation",function(){var e=$(this).parent().parent().children().first(),t=e.children(".more-game-id").text().trim(),o=e.children(".more-game-name").text().trim(),i=$(this).siblings().eq(0).text(),r=$(this).siblings().eq(1).text(),s=$(this).text().trim(),n=$(this).siblings().eq(2).text();console.log(n),bet_info={game_id:t,game_name:o,cotation_id:i,cotation_name:r,cotation_value:s,cotation_kind:n},a(bet_info),$("#more-cotations").modal("close")}),$("#check-ticket-form").on("submit",function(){var e=$(".check-ticket-input").val();if(""==e)alertify.alert("Erro","Você deve informar o número do ticket.");else{var t="/bet_ticket/"+e;$(this).attr("action",t),$(this).submit(),console.log("HEY")}}),$("ul.championship-list li a").each(function(e,t){window.location.pathname==$(t).attr("href")&&$(t).css("color","#1027c7").css("text-decoration","underline")}),$("#user_register_form").on("submit",function(e){e.preventDefault();var t=$(this).serialize();$.post("/user/register/",t,function(e,t,o){console.log(o.status),alertify.alert("Sucesso","Cadastrado com sucesso, você será logado automaticamente. Boas apostas :)").set("onok",function(e){window.location="/"})}).fail(function(e,t,o){console.log(e.responseJSON);var a="";for(erro in e.responseJSON.data)a+=e.responseJSON.data[erro]+"<br>";console.log(a),alertify.alert("Erro",a)})}),$("#change-pass-user-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize();$.post("/user/change_password/",t,function(e,t,o){200==e.status&&(alertify.alert("Sucesso","Senha alterada com sucesso."),$("#modal-change-password").modal("close")),406==e.status&&alertify.alert("Erro","A senha atual não confere.")})})});